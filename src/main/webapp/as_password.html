<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>구해줘용</title>
    <link href="./css/reset.css" rel="stylesheet" />
    <link href="./css/header.css" rel="stylesheet" />
    <link href="./css/footer.css" rel="stylesheet" />
    <link href="./css/main.css" rel="stylesheet" />
    <link href="./css/wanted.css" rel="stylesheet" />
    <link href="./css/wanted-detail.css" rel="stylesheet" />
    <link href="./css/company-detail.css" rel="stylesheet" />

    <link href="./css/as_password.css" rel="stylesheet" />

    <script
      src="https://kit.fontawesome.com/e264982194.js"
      crossorigin="anonymous"
    ></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <script src="/webjars/jquery/jquery.min.js"></script>
    <script src="/webjars/sockjs-client/sockjs.min.js"></script>
    <script src="/webjars/stomp-websocket/stomp.min.js"></script>
    <script src="./js/webSocket.js"></script>
    <script src="./js/proposal.js"></script>
  </head>
  <body>
    <header class="header">
      <div class="header_inner">
        <div class="menu">
          <button class="btn_menu">메뉴</button>
          <ul class="dropdown_menu">
            <li class="menu_top">포지션 목록</li>
            <li><a class="dropdown_item" href="#">백앤드 개발자</a></li>
            <li><a class="dropdown_item" href="#">웹 퍼블리셔</a></li>
            <li><a class="dropdown_item" href="#">프론트앤드 개발자</a></li>
            <li class="menu_bottom">구직은 구해줘용과 함께</li>
          </ul>
        </div>

        <h1 class="logo">
          <a href="#">구해줘용</a>
        </h1>

        <ul class="gnb">
          <li><a href="#">채용</a></li>
          <li><a href="#">이력서</a></li>
        </ul>

        <ul class="login">
          <li class="alert">
            <a href="/mypage/id">알림</a>

            <ul class="alert_item_list">
              <li>
                <a class="alert_item">
                  <div class="messages"></div>
                </a>
              </li>
            </ul>
          </li>
          <li>
            <p class="notifications"></p>
          </li>

          <li class="profile">
            <a href="#">프로필</a>
            <ul class="profile_list">
              <li>
                <a class="profile_item_mypage" href="/mypage/principal.id"
                  >My page</a
                >
              </li>
              <li>
                <a
                  class="profile_item"
                  href="/applicationstatusall/principal.id"
                  >지원 현황</a
                >
              </li>
              <li>
                <a class="profile_item" href="/proposal/principal.id"
                  >제안받기 현황</a
                >
              </li>
              <li><a class="profile_item" href="#">좋아요</a></li>
              <li><a class="profile_item" href="/subscribes/id">구독</a></li>
              <li>
                <a class="profile_item_logout" href="/logout">로그아웃</a>
              </li>
            </ul>
          </li>
        </ul>
        <ul class="companyservice">
          <li><a href="#">기업 서비스</a></li>
        </ul>
      </div>
    </header>

    <div id="wrap">
      <div id="as_wrap">
        <div class="as_menu">
          <p class="as_title">계정설정</p>
          <ul>
            <li class="as_proposal">
              <a href="/users/as/${principal.id}">기본정보 수정</a>
            </li>
            <li class="as_proposal">
              <a href="/users/profile">프로필 수정</a>
            </li>
            <li class="as_position">
              <a href="/users/password/${principal.id}">비밀번호 설정</a>
            </li>
            <li class="as_proposal">
              <a href="/users/delete/${principal.id}">회원 탈퇴</a>
            </li>
          </ul>
        </div>
        <!--as_menu-->
        <div class="as_edit">
          <div>
            <strong>비밀번호 설정</strong>
          </div>
          <div class="as_password">
            <form action="/users/as_password" class="as_password_form">
              <input id="id" type="hidden" value="${users.id}" />
              <div class="as_now_password">
                <div class="text">
                  <p>현재 비밀번호</p>
                </div>
                <form id="submit">
                  <div class="input_password">
                    <input
                      id="userPassword"
                      type="password"
                      placeholder="비밀번호를 입력해주세요"
                      class="input_text"
                      value="${users.userPassword}"
                      readonly="readonly"
                    />
                  </div>
                </form>
              </div>
              <div class="as_new_password">
                <div class="text">
                  <p>새 비밀번호</p>
                </div>
                <div class="input_password">
                  <input
                    id="userNewPassword"
                    type="password"
                    placeholder="비밀번호를 입력해주세요"
                    class="input_text"
                  />
                </div>
                <div class="as_new_password_check">
                  <div class="text">
                    <p>새 비밀번호 확인</p>
                  </div>
                  <div class="input_password_check">
                    <input
                      id="userNewPasswordCheck"
                      type="password"
                      placeholder="비밀번호를 입력해주세요"
                      class="input_text"
                    />
                  </div>
                </div>
              </div>
            </form>
          </div>
          <!--.as_password-->
          <div class="as_button">
            <button id="btnUpdatePassword" type="button">수정하기</button>
          </div>
          <!--as_button-->
        </div>
        <!--.as_edit-->
      </div>
      <!--.as_wrap-->
    </div>
    <script>
      $('#btnUpdatePassword').click(() => {
        passwordupdate();
      });

      function passwordupdate() {
        if (passwordCheck() == false) {
          alert('비밀번호가 일치하지 않습니다.');
          return;
        }

        function passwordCheck() {
          let userNewPassword = $('#userNewPassword').val();
          let userNewPasswordCheck = $('#userNewPasswordCheck').val();
          if (userNewPassword == userNewPasswordCheck) {
            return true;
          } else {
            return false;
          }
        }

        let data = {
          userPassword: $('#userNewPassword').val(),
        };

        let id = $('#id').val();

        $.ajax('/api/users/password/' + id, {
          type: 'PUT',
          dataType: 'json', // 응답 데이터
          data: JSON.stringify(data), // http body에 들고갈 요청 데이터
          headers: {
            // http header에 들고갈 요청 데이터
            'Content-Type': 'application/json; charset=utf-8',
          },
        }).done((res) => {
          if (res.code == 1) {
            alert('비밀번호 수정 완료');
            location.reload(); // f5
          } else {
            alert('업데이트에 실패하였습니다');
          }
        });
      }
    </script>
    <footer class="footer">
      <div class="footer_inner">
        <div class="top">
          <ul class="gnb">
            <li class="logo">구해줘용</li>
            <li><a href="#">기업소개</a></li>
            <li><a href="#">이용약관</a></li>
            <li><a href="#">개인정보 처리방침</a></li>
            <li><a href="#">고객센터</a></li>
          </ul>
        </div>

        <div class="bottom">
          <p>
            (주)구해줘용 (대표이사:구용길) | 서울특별시 용산구 독서당로 111
            한남더힐 12층 | 통신판매번호 : 2020-서울용산-3147
          </p>
          <p>
            유료직업소개사업등록번호 : (국내) 제2022-221001-243-2-00006호 |
            (국외) 서울가고싶부-유-2020-2 | 사업자등록번호 : 012-34-56789 |
            02-123-4567
          </p>
          <p>© 9DoIT, Inc.</p>
        </div>
      </div>
    </footer>
  </body>
</html>
